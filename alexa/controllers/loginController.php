<?phpclass loginController extends Controller {    private $_user;    private $_rol;    private $_permission;    private $_correo;	    public function __construct() {        parent::__construct();        $this->_user = $this->loadModel('user','admin');        $this->_rol = $this->loadModel('rol','admin');        $this->_correo = $this->loadModel('correo','admin');        //$this->_permission = $this->loadModel('permission','admin');            }    public function index() {    }    public function login() {        $postdata = file_get_contents("php://input");        $postdata=json_decode($postdata,true);        if (!$postdata) {            $postdata['user']=$_POST['user'];            $postdata['password']=$_POST['password'];        }        $mensaje = array('message' =>'' ,'data'=>'' ,'state'=>'');            if (!$postdata['user'] || !$postdata['password']) {                    $mensaje['message']='error!.';                    $mensaje['state']=0;                    $mensaje['data']='Usuario no encontrado!.';        }        else        {            $condicion = " login='{$postdata['user']}'";            $data=$this->_user->consult($condicion);            if (count($data)>0) {                                  if ($data[0]['password'] == Hash::getHash('sha1', $postdata['password'], $data[0]['id'])) {                        $randon = rand(1,999);                        $token = Hash::getHash('sha1', $randon , $data[0]['id']);                                                $this->_user->token( $data[0]['id'] , $token );                        $data = $this->_user->consult(' id='.$data[0]['id']);                        $dato = array('nombre' =>'','token' =>'','img' =>'','rol'=>'','permisos'=>'' );                        $modulos = array('nombre' => '', 'permisos' =>'' );                        for ($i=0; $i < count($data) ; $i++) {                             $dato['nombre']=$data[$i]['name'];                            $dato['token']=$data[$i]['token'];                            $dato['img']=$data[$i]['img'];                            $rol = $this->_rol->consult(' id='.$data[$i]['rol_id']);                                                        $dato['rol']=$rol[0]['name'];                            $permission= $this->_rol->permisos($data[$i]['rol_id']);                            $dato['permisos']=$permission;                        }                        $mensaje['message']='success';                        $mensaje['state']='1';                        $mensaje['data']=$dato;                    }                            }            else            {                $mensaje['message']='error';                $mensaje['data']='Usuario no encontrado!.';            }        }              echo json_encode($mensaje);                }        public function logout() {}	    public function pruebacorreo(){            $body = "Usuario:  correo de prueba<br/>" . "Password:pueba";            $body=$this->_correo->cuerpo($body,"prueba");                  $this->getLibrary("xpm" . DS . "SMTP");            $email="tahito1987@gmail.com";            $m = 'From: '.EMAIL_USER."\r\n".                 'To: '.$email."\r\n".                 'Subject: AprobaciÃ³n'."\r\n".                 'Content-Type: text/plain'."\r\n\r\n".                 ''.$body;            $c = SMTP::connect(EMAIL_HOST, (int) EMAIL_SALIDA,EMAIL_USER, EMAIL_PASS, 'tls', 10) or die(print_r($_RESULT));            $s = SMTP::send($c, array($email), $m, EMAIL_USER);    }   }?>