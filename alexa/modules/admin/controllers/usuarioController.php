<?phpclass usuarioController extends Controller {        private $_user;    public function __construct() {        parent::__construct();                $this->_user = $this->loadModel('user', 'admin');                    }    public function index(){    }    public function crearusuarioshop(){                $postdata = file_get_contents("php://input");        $postdata=json_decode($postdata,true);        $data = array();        $randon = rand(1,999);        $token = Hash::getHash('sha1', $randon , $randon);        $mensaje = array('message' =>'' ,'data'=>'' ,'state'=>'');            if(!$_POST || !$postdata)        {            $mensaje['message']='error';            $mensaje['data']='No se pudo crear la tienda!.';            $mensaje['state']='0';            echo json_encode($mensaje);            exit;        }        if (!$postdata) {            $data[':name']=$_POST['nombre'];            $data[':email']=$_POST['correo'];            $data[':contact']=$_POST['telefono'];            $data[':state']=2;            $data[':rol_id']=2;            $data[':token']=$token;                    }        else {            // estado de los usuairos 0 eliminado 1 activo 2 por activar             $data[':name']=$postdata['nombre'];            $data[':email']=$postdata['correo'];            $data[':contact']=$postdata['telefono'];            $data[':state']=2;            $data[':rol_id']=2;            $data[':token']=$token;                     }                                  if (!$data[':name'] || !$data[':email'] || !$data[':contact']) {            $mensaje['message']='error';            $mensaje['data']='No se pudo crear la tienda!.';            $mensaje['state']='0';         }         else{            $this->_user->createshop( $data );         //   echo "".$token."-".$data[':email'] ;            $this->correovalidacion($token, $data[':email'] );            $mensaje['message']='success';            $mensaje['state']='1';            $mensaje['data']="Creación exitosa!.";         }        echo json_encode($mensaje);    }       public function crearusuario(){                $postdata = file_get_contents("php://input");        $postdata=json_decode($postdata,true);        $data = array();        $randon = rand(1,999);        $token = Hash::getHash('sha1', $randon , $randon);        $mensaje = array('message' =>'' ,'data'=>'' ,'state'=>'');             if(!$_POST || !$postdata)        {            $mensaje['message']='error';            $mensaje['data']='No se pudo crear el usuairo!.';            $mensaje['state']='0';            echo json_encode($mensaje);            exit;        }        if (!$postdata) {            $data[':name']=$_POST['nombre'];            $data[':email']=$_POST['correo'];            $data[':contact']=$_POST['telefono'];            $data[':state']=2;            $data[':rol_id']=2;            $data[':token']=$token;        }        else {            // estado de los usuairos 0 eliminado 1 activo 2 por activar             $data[':name']=$postdata['nombre'];            $data[':email']=$postdata['correo'];            $data[':contact']=$postdata['telefono'];            $data[':state']=2;            $data[':rol_id']=2;            $data[':token']=$token;         }                          if (!$data[':name'] || !$data[':email'] || !$data[':contact']) {            $mensaje['message']='error';            $mensaje['data']='No se pudo crear el usuairo!.';            $mensaje['state']='0';         }         else{            $this->_user->createshop( $data );            $this->correovalidacion($token, $data[':email'] );            $mensaje['message']='success';            $mensaje['state']='1';            $mensaje['data']="Creación exitosa!.";         }        echo json_encode($mensaje);    }    // hace runa validacion de campos         public function correovalidacion($token,$correo){            $body = "Por favor ingresar a este link para la validación del perfil::".BASE_URL."/admin/usuario/validar/".$token;          //  $body=$this->_correo->cuerpo($body,"Link de validación.");            //$correo="tahito1987@gmail.com";            $this->getLibrary("xpm" . DS . "SMTP");            $email=$correo;            $m = 'From: '.EMAIL_USER."\r\n".                 'To: '.$correo."\r\n".                 'Subject: Aprobación'."\r\n".                 'Content-Type: text/plain'."\r\n\r\n".                 ''.$body;            $c = SMTP::connect(EMAIL_HOST, (int) EMAIL_SALIDA,EMAIL_USER, EMAIL_PASS, 'tls', 10) or die(print_r($_RESULT));            $s = SMTP::send($c, array($email), $m, EMAIL_USER);    }    public function validar($token)    {                // sacar id  con el token                 $usuairo=$this->_user->consult( ' token="'.$token.'"' );                $this->_view->assign('usuario', $usuairo);        $this->_view->renderizar('validar', 'usuario');    }    public function perfil($token)    {          $condicion=" token='".$token."'";          $usuario =$this->_user->consult($condicion);          $mensaje = array('message' =>'' ,'data'=>'' ,'state'=>'');              if (count($usuario)>0){            $mensaje = array('message' =>'ok' ,'data'=>$usuario ,'state'=>'1');                echo json_encode($mensaje);            }          else{           $mensaje = array('message' =>'error' ,'data'=>"No se encontraron datos!." ,'state'=>'0');                echo json_encode($mensaje);             }              }}?>