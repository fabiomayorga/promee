<?phpclass solicitudModel extends Model {    public function __construct() {        parent::__construct();    }    public function consultar($condicion = '1') {        $data = $this->_db->query(" SELECT id, codigo, fecha_pedido, fecha_limite, realizado_por, contrato_area, centro_costo, proveedor, observacion, fecha_creacion, id_usu , estado, usu.usu_nombre as usuario                                    FROM solicitud                                     INNER JOIN usu ON usu.usu_key = solicitud.id_usu                                     WHERE  " . $condicion);        if ($data) {            $data= $data->fetchall();                for ($i=0; $i <count($data) ; $i++) {                 $condicionp=" id_solicitud = ".$data[$i]['id'];                $producto = $this->_db->query("SELECT id, descripcion,unidad_comercial, cantidad_pedida,cantidad_despachada,valor_unitario,valor_iva, id_solicitud FROM producto WHERE" . $condicionp);                $data[$i]['productos']=$producto->fetchall();             }        }        if ($data)        return $data;    }    public function crear($datos) {        //          0 no aprobado         // estados  1 precios         //          2 validacion de gerente        //          3 entrega        //          4 recibido        $this->_db->prepare("INSERT INTO solicitud ( codigo ,  fecha_pedido ,  fecha_limite ,  realizado_por ,  contrato_area,                                         centro_costo ,  proveedor ,  observacion ,  fecha_creacion , id_usu , estado )                              VALUES (:codigo ,:fecha_pedido ,:fecha_limite ,:realizado_por ,:contrato_area,                                         :centro_costo ,:proveedor ,:observacion ,:fecha_creacion ,:id_usu,1 )")                    ->execute($datos);        $condicion = " codigo = '" . $datos[':codigo'] . "'";        $key = $this->consultar($condicion);        return $key[0];    }    public function crearProductos($datos) {               $this->_db->prepare("INSERT INTO  producto (descripcion,unidad_comercial,cantidad_pedida,cantidad_despachada,                                                     valor_unitario,valor_iva,id_solicitud )                              VALUES (:descripcion ,:unidad_comercial ,:cantidad_pedida ,:cantidad_despachada ,:valor_unitario,                                         :valor_iva ,:id_solicitud )")                    ->execute($datos);    }    public function cambioEstado($id,$estado) {        $this->_db->prepare("UPDATE solicitud SET estado=:estado WHERE id = :id")               ->execute(                        array(                            ':id' => $id,                            ':estado' => $estado        ));    }     public function entrega($id,$who) {        $this->_db->prepare("UPDATE solicitud SET id_usu_entrega=:who WHERE id = :id")               ->execute(                        array(                            ':id' => $id,                            ':who' => $who        ));    }    public function precios($datos)    {      $this->_db->prepare("UPDATE producto SET unidad_comercial=:unidad_comercial , cantidad_despachada=:cantidad_despachada ,                                               valor_unitario=:valor_unitario ,valor_iva=:valor_iva                           WHERE id = :id")               ->execute(                        array(                            ':unidad_comercial' => $datos['unidad_comercial'],                            ':cantidad_despachada' => $datos['cantidad_despachada'],                            ':valor_unitario' => $datos['valor_unitario'],                            ':valor_iva' => $datos['valor_iva'],                            ':id' => $datos['id']        ));    }       public function consultarline($condicion = '1') {        $data = $this->_db->query(" SELECT fecha_creacion as fecha, count(id) as cantidad FROM solicitud WHERE 1 GROUP BY fecha_creacion");                if ($data)        return  $data->fetchall();;    }}?>